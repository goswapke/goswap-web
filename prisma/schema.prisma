generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  role      String   @default("TRAVELER") // TRAVELER | PARTNER | ADMIN
  isAdmin   Boolean  @default(false)
  createdAt DateTime @default(now())
  vehicles  Vehicle[]
  bookings  Booking[]
}

model Vehicle {
  id                String   @id @default(cuid())
  ownerId           String
  owner             User     @relation(fields: [ownerId], references: [id])
  make              String
  model             String
  year              Int
  fuelType          String
  type              String
  plate             String
  primaryCity       String
  preferredSwapCity String?
  category          String   @default("LEASE")            // LEASE | SWAP
  status            String   @default("PENDING_APPROVAL") // PENDING_APPROVAL | AVAILABLE | BOOKED | ARCHIVED
  photos            String[]                             // URLs
  priceSelf         Int                                   // per day (KES)
  priceChauffeured  Int                                   // per day (KES)
  createdAt         DateTime @default(now())
  bookings          Booking[]
}

model Booking {
  id         String   @id @default(cuid())
  vehicleId  String
  vehicle    Vehicle  @relation(fields: [vehicleId], references: [id])
  travelerId String
  traveler   User     @relation(fields: [travelerId], references: [id])
  startDate  DateTime
  endDate    DateTime
  pickupType String   // SGR | AIRPORT | CITY_CENTER
  driveMode  String   // SELF_DRIVE | CHAUFFEURED
  arrivalAt  DateTime
  total      Int
  status     String   @default("PENDING")
  paymentId  String?
  payment    Payment? @relation(fields: [paymentId], references: [id])
  createdAt  DateTime @default(now())
}

model Payment {
  id        String    @id @default(cuid())
  kind      String    // LEASE | SWAP_FEE
  status    String    @default("PENDING") // PENDING | PAID | FAILED
  amount    Int
  currency  String    @default("KES")
  meta      Json?
  createdAt DateTime  @default(now())
  bookings  Booking[] // <-- back relation so Prisma understands the link
}
